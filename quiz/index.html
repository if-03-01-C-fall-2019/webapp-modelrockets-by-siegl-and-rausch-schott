<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Modelrockets - Quiz</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="../css/modelrockets.css">

    <script type="text/javascript">
    var globalQuestions;
    var rightAnswers = [];

    var quizFinished = false;

    var correctAnswerCount = 0;

    function initQuiz(){
      //Remove Information article
      var element = document.getElementById('information-quiz');
      element.parentNode.removeChild(element);

      //Get Questions
      fetchQuestions();
    }

      function fetchQuestions(){
        fetch("http://dev.byiconic.at:3000/questions").then (response => response.json())
        .then(function(data){
          globalQuestions = data;
          loadQuestions(data);
        })
        .catch( function (error) {
          console.log("error: " + error);
          document.getElementById('errorLoading').removeAttribute("hidden");
        });
      }

      function shuffle(array) {
          var ctr = array.length, temp, index;

          while (ctr-- > 0) {
              index = Math.floor(Math.random() * ctr);
              temp = array[ctr];
              array[ctr] = array[index];
              array[index] = temp;
          }
          return array;
      }

      function loadQuestions(questions) {
        console.log("loading questions");

        var fullOutput = "";
        for(let i = 0; i < 10; i++){
          var question = questions[i];
          rightAnswers.push(question.rightAnswer);

          var answerArr = [question.AnswerOne,
                           question.AnswerTwo,
                           question.AnswerThree,
                           question.AnswerFour];
          shuffle(answerArr);

          var output = "<article class=\"questionArticle\"><h5>Question No. "+(i+1)+"</h5><p class=\"question\">"+question.Question+"</p><label class=\"answerHead\">Ihre Antwort</label><select class=\"form-control\" id=\"answer"+(i+1)+"\"><option>Antwort ausw√§hlen. . .</option><option>"+answerArr[0]+"</option><option>"+answerArr[1]+"</option><option>"+answerArr[2]+"</option><option>"+answerArr[3]+"</option></select><p class=\"answerResponse\" id=\"response"+(i+1)+"\"></p></article>";
          fullOutput += output;
        }

        fullOutput += "<section><div class=\"container\"><div class=\"text-center\"><input id=\"submitButton\"type=\"submit\"value=\"CheckAnswers\"></div></div></section>"
        document.getElementById('questions').innerHTML = fullOutput;

        console.log("loaded questions");
      }

      function checkAnswers(){
        if(quizFinished){
          console.log("Quiz already done!");
          return;
        }

        console.log("checking answers");

        var selectedAnswer = "";

        for(let i = 0; i < 10; i++){
          var answerElem = document.getElementById("answer" + (i+1));
          if(answerElem.value == rightAnswers[i]){
            document.getElementById("response" + (i+1)).innerHTML = "Correct Answer!";
            correctAnswerCount++;
          }
          else {
            document.getElementById("response" + (i+1)).innerHTML = "Wrong answer! Right one is: " + rightAnswers[i];
          }
        }

        quizFinished = true;

        //Get Results
        var percentage = (correctAnswerCount / 10) * 100;
        console.log(percentage);

        //Show statistics
        var statisticsOutput = "<article id=\"quizResults\" class=\"questionArticle\"><h5>Statistics</h5><p>You reached "+percentage+"%</p></article>";
        document.getElementById("innerContent").innerHTML = statisticsOutput;


      }
    </script>
  </head>
  <body>
    <section id="nav">
        <!-- Navigationbar !-->
        <nav id="navbar" class="w3-bar w3-black w3-card-4">
          <div class="container">
            <a href=".." class="w3-bar-item w3-button w3-mobile w3-hover-yellow w3-text-yellow">Modelrockets</a>

            <a href="../plansforwebsite" class="w3-bar-item w3-button w3-mobile w3-hover-yellow w3-right">Change Logs</a>
            <a href="#top" class="w3-bar-item w3-button w3-mobile w3-hover-yellow w3-right w3-yellow">Quiz</a>
            <a href="../fuel" class="w3-bar-item w3-button w3-mobile w3-hover-yellow w3-right">Manual for Rocketfuel</a>
            <a href="../components" class="w3-bar-item w3-button w3-mobile w3-hover-yellow w3-right">Components of Modelrocket</a>
            <a href=".." class="w3-bar-item w3-button w3-mobile w3-hover-yellow w3-right">Introduction</a>

          </div>
        </nav>
        <!-- Navbar ende -->

        <div class="w3-yellow w3-card-4">
          <h1 id="heading">Quiz - Test your knowledge</h1>
        </div>
    </section>

    <section id="content">

        <section>
          <div class="container w3-round">
            <div id="innerContent" class="w3-padding-24">


              <form action="javascript:checkAnswers()">
                <article id="errorAnswers" class="errorArticle" hidden>
                  <h3>You must fill in all answers!</h3>
                </article>
                <article id="errorLoading" class="errorArticle" hidden>
                  <h3>There was an error while loading the questions.</h3>
                </article>

                <article id="information-quiz" class="questionArticle">
                  <h5>Information</h5>
                  <p class="question">
                  Read the following questions below and select your answer. After you filled in all your answers, click the "CheckAnswers" button to check your answers and see your score.
                  <br>
                  Good luck!
                </p>
                <button id="gotitButton" onclick="initQuiz()">Got it!</button>
                </article>

                <div id="questions">
                  <br>
                  <br>

                </div>

              </form>
            </div>
          </div>
        </section>
      </section>
  </body>
</html>
